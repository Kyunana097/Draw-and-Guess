# 远程连接与故障排查指南

## 问题1: 使用远程IP地址时崩溃

### 原因分析
当使用远程服务器地址（如 81.68.144.16）时，可能会遇到以下问题：
1. **网络延迟**：远程连接比本地连接慢，可能导致超时
2. **UI未初始化**：大厅界面可能在网络消息到达前未初始化
3. **防火墙阻止**：服务器或客户端防火墙可能阻止连接

### 已实施的修复
✅ 添加了连接超时机制（5秒）
✅ 修复了大厅和房间列表UI的初始化逻辑
✅ 改进了错误处理和异常捕获
✅ 优化了聊天消息的处理逻辑

### 使用建议

#### 1. 服务器端配置
确保服务器监听所有网络接口：
```bash
# 在 server-deploy/server.py 中或通过环境变量
HOST=0.0.0.0 PORT=5555 python server-deploy/server.py
```

#### 2. 防火墙配置
服务器端需要开放端口：
```bash
# Ubuntu/Debian
sudo ufw allow 5555/tcp

# CentOS/RHEL
sudo firewall-cmd --add-port=5555/tcp --permanent
sudo firewall-cmd --reload
```

#### 3. 客户端配置
在设置界面修改服务器地址：
- 服务器地址: `81.68.144.16`
- 服务器端口: `5555`

#### 4. 网络测试
连接前先测试网络：
```bash
# 测试连接
ping 81.68.144.16

# 测试端口
telnet 81.68.144.16 5555
# 或
nc -zv 81.68.144.16 5555
```

## 问题2: run_game.sh 启动失败

### 原因
新创建的 `run_game.sh` 没有激活虚拟环境，导致找不到 pygame 模块。

### 已实施的修复
✅ 更新了 `run_game.sh`，添加虚拟环境激活
✅ 自动创建虚拟环境（如果不存在）
✅ 自动安装依赖

### 使用方法
```bash
# 给脚本添加执行权限（如果还没有）
chmod +x run_game.sh

# 运行脚本
./run_game.sh
```

## 推荐的启动方式

### 本地测试
使用 `start.sh`（最稳定）：
```bash
./start.sh
# 选择选项 3: 同时启动服务器和客户端
```

### 局域网/远程游戏

#### 服务器端
```bash
cd server-deploy
HOST=0.0.0.0 PORT=5555 python server.py
```

#### 客户端
1. 启动客户端：
```bash
./start.sh
# 选择选项 2: 启动客户端
```

2. 在客户端设置界面修改服务器地址为远程IP

3. 返回主菜单，进入房间列表

## 常见问题

### Q1: 连接超时
**解决方案**：
- 检查网络连接
- 确认服务器正在运行
- 检查防火墙设置
- 尝试 ping 服务器IP

### Q2: 大厅界面空白
**解决方案**：
- 已修复UI初始化问题
- 确保先进入房间列表再创建/加入房间

### Q3: 点击按钮无反应
**解决方案**：
- 检查网络连接是否正常
- 查看终端是否有错误信息
- 重启客户端

### Q4: 聊天消息不显示
**解决方案**：
- 已修复聊天处理逻辑
- 确保UI已完全加载
- 检查是否在正确的界面（大厅或游戏中）

## 调试技巧

### 查看详细日志
服务器端会输出详细日志到 `server.log`：
```bash
tail -f server-deploy/server.log
```

### 客户端调试
客户端会在终端输出日志信息，包括：
- 网络连接状态
- 消息接收情况
- UI事件处理

### 网络抓包
如果需要调试网络问题：
```bash
# 监听5555端口的流量
sudo tcpdump -i any port 5555 -A
```

## 性能优化建议

### 远程游戏
- 使用稳定的网络连接（有线优于无线）
- 避免大量玩家同时绘画
- 适当增加轮次时间以适应网络延迟

### 本地游戏
- 使用 127.0.0.1 作为服务器地址
- 可以支持更多玩家和更快的交互

## 更新日志

### v2.0.1 (2025-12-30)
- ✅ 修复远程连接超时问题
- ✅ 修复大厅UI初始化问题
- ✅ 改进聊天消息处理
- ✅ 更新 run_game.sh 支持虚拟环境
- ✅ 添加连接超时机制（5秒）
- ✅ 改进错误提示信息

## 联系支持

如果问题仍然存在，请：
1. 查看终端错误信息
2. 查看 server.log 日志
3. 尝试本地连接确认基本功能正常
4. 提交 Issue 并附上错误日志
